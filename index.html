<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>枝豆を当てるゲーム</title>
<style>
  body {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    min-height: 100vh;
    margin: 0;
    background-color: #f0f0f0;
  }
  #container {
    position: relative;
    width: 600px;
    height: 100px;
    background-color: #ffffff;
    border-radius: 10px;
    display: flex;
    justify-content: space-around;
    align-items: center;
  }
  .bean {
    width: 40px;
    height: 80px;
    background-image: url('mame.png');
    background-size: contain;
    background-repeat: no-repeat;
    cursor: pointer;
    position: absolute;
    transition: left 0.5s ease-in-out;
  }
  .hit {
    background-image: url('right.png');
  }
  #message {
    margin-top: 20px;
    font-size: 24px;
    font-weight: bold;
  }
  #restartButton {
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    background-color: #86B300;
    color: #ffffff;
    border: none;
    border-radius: 5px;
    display: none;
  }
  #winImage {
    max-width: 100%;
    max-height: 100vh;
    display: none;
  }
</style>
</head>
<body>
<div id="container"></div>
<div id="message"></div>
<button id="restartButton" onclick="startGame()">再挑戦</button>
<img id="winImage" src="beel007.jpg" alt="Win Image" />
<audio id="successSound" src="success.mp3" preload="auto"></audio>
<audio id="failSound" src="fail.mp3" preload="auto"></audio>

<script>
let beans, correctCount;
const requiredCorrectCount = 8;
const shuffleDelay = 3000;
const positions = [0, 60, 120, 180, 240, 300, 360, 420, 480, 540];

function createBeans() {
  const container = document.getElementById('container');
  for (let i = 0; i < 10; i++) {
    const bean = document.createElement('div');
    bean.id = 'bean' + i;
    bean.className = 'bean';
    bean.onclick = () => checkBean(i);
    bean.style.left = positions[i] + 'px';
    container.appendChild(bean);
  }
}

function startGame() {
  beans = Array(10).fill().map((_, i) => ({ index: i, isContentPresent: i < requiredCorrectCount }));
  correctCount = 0;
  document.getElementById('message').textContent = '豆が入っているものを覚えてください！';
  document.getElementById('restartButton').style.display = 'none';
  document.getElementById('container').style.display = 'flex';
  document.getElementById('winImage').style.display = 'none';
  for (let bean of beans) {
    document.getElementById('bean' + bean.index).classList.toggle('hit', bean.isContentPresent);
    document.getElementById('bean' + bean.index).style.pointerEvents = 'none';
  }
  setTimeout(shuffleAndStart, shuffleDelay);
}

function shuffleAndStart() {
  for (let bean of beans) {
    document.getElementById('bean' + bean.index).classList.remove('hit');
  }
  document.getElementById('message').textContent = 'シャッフル中...';
  beans.sort(() => Math.random() - 0.5);
  const shuffledPositions = positions.slice().sort(() => Math.random() - 0.5);
  for (let i = 0; i < 10; i++) {
    document.getElementById('bean' + beans[i].index).style.left = shuffledPositions[i] + 'px';
  }
  setTimeout(() => {
    document.getElementById('message').textContent = '正しい豆を選んでください！';
    for (let bean of beans) {
      document.getElementById('bean' + bean.index).style.pointerEvents = 'auto';
    }
  }, shuffleDelay);
}

function checkBean(index) {
  let messageDiv = document.getElementById('message');
  const bean = beans.find(b => b.index === index);
  if (bean.isContentPresent) {
    document.getElementById('bean' + index).classList.add('hit');
    document.getElementById('successSound').play();
    correctCount++;
    if (correctCount === requiredCorrectCount) {
      messageDiv.textContent = 'おめでとうございます！あなたの勝ちです！';
      document.getElementById('container').style.display = 'none';
      document.getElementById('message').style.display = 'none';
      document.getElementById('restartButton').style.display = 'none';
      document.getElementById('winImage').style.display = 'block';
    } else {
      messageDiv.textContent = `当たり！ あと${requiredCorrectCount - correctCount}回正解すれば勝ちです。`;
    }
  } else {
    document.getElementById('failSound').play();
    messageDiv.textContent = '残念、もう一回';
    document.getElementById('restartButton').style.display = 'block';
    disableBeans();
  }
}

function disableBeans() {
  for (let bean of beans) {
    document.getElementById('bean' + bean.index).style.pointerEvents = 'none';
  }
}

createBeans();
startGame();
</script>
</body>
</html>

